# 函数式编程

函数式编程(FP的概念在这几年炒的火热，但网上讲的概念都太过于复杂让人难以理解。其实我们在日常的代码编写中已经有意无意的写出了函数式风格的代码只是我们不清楚而已。这里我以本人的理解来介绍一下函数式编程。不会涉及到很复杂的概念，当然网上那些很复杂的介绍我也看不懂。如果有错误的地方可以提issue一起来讨论。

## 前置知识

首先我们要明确几点知识来帮助我们更好的了解函数式编程

- 函数式编程是一种编程风格，只要你按照这种风格来编码就可以说是函数式的，与语言无关。只是有些语言天生契合函数式比如Haskell
- 函数式编程于面向对象编程(OOP)不存在孰优孰劣，只是各自有适用场景，不存在函数式编程一定比OOP好的说法
- 经常见到的一句话`函数是一等公民`，简单理解就是函数既可以作为返回值也可以作为参数。这点在js中经常体现比如闭包就是返回了一个函数，所以其实我们经常有意无意的也在写函数式的代码

## 与命令式编程的区别

> 函数式编程关心数据的映射，命令式编程关心解决问题的步骤

如何理解这句话呢，我们在日常开发中写的代码大多是命令式的，就是让我们来告诉计算机这个程序的每一步要怎么执行。举两段代码

```js
function foo (a, b) {
    let res = a + b
    res += 2
    return res
}
```

```js
function bar () {
    const arr = [1,2,3,4]
    const newArr = []
    
    for (const i in arr) {
        newArr.push(arr[i] + 1)
    }

    return newArr
}
```

上面的两段代码我们的每一行都可以看作是一个指令，来告诉计算机要怎么处理这个变量(常量)，这样的代码有两个缺点

- 代码抽象度低，重复度高
- 看起来很杂乱

这意味着以后我们其他的模块需要实现类似的功能需要把这段代码修改一下再把代码copy一遍。

让我们把这两段代码换成函数式的风格要怎么写呢？

```js
function foo (a, b) {
    let res = Sum(a, b)
    res = Sum(res, 2) 
    return res
}

```

```js

function addOne (arr) {
    return arr.map(item => ++item)
}

function bar () {
    const arr = [1,2,3,4]
    return addOne(arr)
}
```

以上的例子很简单，但是将这段代码改成函数式的思维我们可以看出我们提升了代码的抽象度。我们的数据都是一个函数的返回值，函数式编程的思想就是，我不需要关注每一步具体干了什么，我只需要知道我的最终结果是经过了哪些函数调用得到的。可以说函数是我们程序中的最小单位。当然仅仅是以这种思想来开发程序还是不够的，为了实现纯粹的函数式编程，我们需要遵守一些规范。

## 函数式编程的一些规范

因为我们的结果是通过一系列函数的调用得到的，那我们得保证这些函数在任何情况下的输出都是确定的。否则程序就乱套了。如果一个函数的结果是确定的，意味着我们可以任意组合，并行的执行某些函数而不用担心结果的不确定性安全问题，为了实现这种开发方式，我们需要遵循以下几点原则。

### 纯函数

所谓纯函数即相同的输入一定得到相同的输出。这意味着我们的函数内部的实现不能依赖当前的环境，也不能产生effect(副作用)。例如对全局变量做了一些修改，或者是依赖某个网络请求的返回值，这种写法都很可能会导致我们的函数不纯。

### immutable 不可变的

我们的函数不能直接对输入值做修改，而要返回一个新的值，这种思想是非常重要的，保证数据是不可变的可以极大减少我们出bug的几率。这点思想在Redux的设计理念中得到充分的提现,我们的reducer就是一个纯函数，当你触发一个action的时候，它会返回一个新的state，而不是直接在原有的state上进行修改。

## 与OOP的比较

这里我们摘录[深入浅出Rxjs](https://item.jd.com/12336101.html)一书中的内容

![](https://gw.alicdn.com/tfs/TB1O3YGtoY1gK0jSZFCXXcwqXXa-1180-1106.jpg)

## 是否一定要函数式

其实我们日常开发中的大部分是将命令式与函数式结合起来一起写，例如上面举的例子

```js
function foo (a, b) {
    let res
    res += Sum(a, b)
    res = Sum(res, 2) 
    return res
}

```

这个其实不太算纯粹的函数式写法而是将核心逻辑以函数的形式表示，但是函数的执行调用仍然是使用命令式的方式来编写，将其写成完全的函数式的写法为

```js
function foo (a, b) {
    return Sum(Sum(a, b), 2)
}
```

但个人看法没有必要写成完全函数式的，这样对心智要求较高且意义不是非常明显。我们只需要秉承最核心的思想，即用函数来表示程序, 用函数的组合来表达程序的组合。盲目的追求完全函数式写出来的代码反而让人难以看懂难以维护。

## 小tips

如何判断一段代码是否是函数式还是命令式，用到for循环的代码肯定不是函数式